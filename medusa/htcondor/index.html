<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="author" content="Alex Waite" />
  <title>IPSY Docs &ndash; HTCondor</title>
  <link rel="license" hreflang="en" href="../../copyright.html" />

  <link rel="stylesheet" type="text/css" href="/theme/css/style.css">
</head>

<body>
  <aside>
    <h1><a href="/">IPSY Docs</a></h1>
    <nav>
      <ul>

              <li><a href="/how_to_ask/">How to Ask for Help</a></li>
              <li>
                <a href="/medusa/">Medusa</a>

                <ul>
                  <li>
                    <a href="/medusa/code_of_conduct/">Code of Conduct</a>
                  </li>
                  <li>
                    <a href="/medusa/access/">Accessing</a>
                  </li>
                  <li>
                    <a class="active" href="/medusa/htcondor/">HTCondor</a>
<div id="toc"><ul><li><a class="toc-href" href='#the "ideal" job' title='The "Ideal" Job'>The "Ideal" Job</a></li><li><a class="toc-href" href="#prioritization of jobs" title="Prioritization of Jobs">Prioritization of Jobs</a></li><li><a class="toc-href" href="#slots" title="Slots">Slots</a></li><li><a class="toc-href" href="#matlab" title="Matlab">Matlab</a></li><li><a class="toc-href" href="#intel vs amd" title="Intel vs AMD">Intel vs AMD</a></li></ul></div>                  </li>
                  <li>
                    <a href="/medusa/data/">Data</a>
                  </li>
                  <li>
                    <a href="/medusa/software/">Software</a>
                  </li>
                  <li>
                    <a href="/medusa/data_center/">Data Center</a>
                  </li>
                  <li>
                    <a href="/medusa/hardware/">Hardware</a>
                  </li>
                </ul>
              </li>
              <li><a href="/labs/">Experimental Labs</a></li>
              <li><a href="/tools/">Tools</a></li>
              <li><a href="/services/">Services</a></li>
              <li><a href="/faq/">Frequently Asked Questions</a></li>
              <li><a href="/contributing/">Contributing to the Docs</a></li>
              <li><a href="/news/">News</a></li>
      </ul>
    </nav>
    <form class="searchbox" action="/search.html">
      <input type="text" name="q" id="tipue_search_input" placeholder="Search">
    </form>
  </aside>

  <main>
    <div id='content'>
<article>
  <header>
    <nav>
      <ul class="breadcrumbs">
        <li><a href="/">Home</a></li>
        <li> > <a href="/medusa/">Medusa</a></li>
        <li> > HTCondor</li>
      </ul>
    </nav>
    <h1>HTCondor</h1>
  </header>

  <div>
    <p>This document focuses on how HTCondor is configured and intended to be used on
our cluster. To learn about Condor and how to use it, you should read the
<a class="reference external" href="../../tools/htcondor/">Tools &gt; HTCondor</a> page.</p>
<p class="todo"><strong>TODO:</strong> This page needs some love.</p>
<div class="section" id="the-ideal-job">
<h2 id='the "ideal" job'>The "Ideal" Job<a class="headerlink" href="#the-ideal-job" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<p>The "ideal" job is [1 CPU &times; 4 GiB] and runs for 1-3 hours. Of course, not
every analysis/step can be broken down into sub-jobs that match this ideal. But
experience has shown that, with a little effort, the majority of analysis at
IPSY can.</p>
<p>Smaller jobs are good: simply, they are more granular and thus better fit
(Tetris style) into the available compute resources.</p>
<p>Shorter jobs are also preferred; duration directly affects the turnover of jobs
and how frequently compute resources become available. If 10,000x 1 hour jobs
are submitted, after awhile, a job will be finishing every minute or so (due to
normal variations across the cluster).</p>
<p>Maintaining liquidity (aka job turnover) is critical for user priority to remain
relevant (as discussed in the section Prioritization of Jobs) and ensure the
fair-distribution-of <em>and</em> timely-access-to compute resources &mdash; rather than
merely rewarding those who submit jobs first.</p>
<p>10,000 jobs lasting 1 hour each is <em>far</em> better than 1,000 jobs lasting 10 hours
each.</p>
</div>
<div class="section" id="prioritization-of-jobs">
<h2 id="prioritization of jobs">Prioritization of Jobs<a class="headerlink" href="#prioritization-of-jobs" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<p>Condor on Medusa is configured to assess user priority only when jobs are
starting. The more compute resources consumed by the user, the more their
priority is punished (increased). This "punishment" decays back to normal over
the course of a day or two.</p>
<p>In practice, it works like this:</p>
<ul class="simple">
<li>Julie submits 30,000 jobs, each ~1 hour long</li>
<li>A day later, Jimbo submits 10 jobs</li>
<li>Jimbo's jobs wait in the queue</li>
<li>As some of Julie's jobs finish, resources are freed up</li>
<li>Both Julie's and Jimbo's jobs compete for the free resources. Jimbo's win
because his priority is low (good) and hers is very high (bad).</li>
</ul>
<p>There is also the <tt class="docutils literal">Priority Factor</tt>. Users who are <em>not</em> members of IPSY
have a modifier that punishes them even more. This way, in most cases, the jobs
of IPSY members will be preferred over those of non-IPSY users.</p>
<p>You can check you usage, priority, and priority factor using
<tt class="docutils literal">condor_userprio <span class="pre">--allusers</span></tt>.</p>
</div>
<div class="section" id="slots">
<h2 id="slots">Slots<a class="headerlink" href="#slots" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<p>Medusa is configured to allow a diversity of different job sizes, while
protecting against large jobs swamping the entire cluster &mdash; and also encouraging
users to break their analysis into smaller steps.</p>
<p>The slots on Medusa are:</p>
<pre class="code literal-block">
16x    1 cpu,   4 GiB   ( 4.0 GiB/cpu)
16x    1 cpu,   6 GiB   ( 6.0 GiB/cpu)
12x    1 cpu,   5 GiB   ( 5.0 GiB/cpu)
 6x   10 cpu,  85 GiB   ( 8.5 GiB/cpu)
 2x   16 cpu, 255 GiB   (15.9 GiB/cpu)
 1x   48 cpu, 190 GiB   ( 3.9 GiB/cpu)
 1x   20 cpu,  95 GiB   ( 4.7 GiB/cpu)
 1x   16 cpu, 415 GiB   (25.9 GiB/cpu)
 1x    8 cpu,  62 GiB   ( 7.7 GiB/cpu)
 1x    4 cpu,  18 GiB   ( 4.5 GiB/cpu)
</pre>
<p>All slots larger than 1 CPU are partitionable &mdash; and thus can be broken into many
smaller slots. To illustrate: there are only 44x 1 CPU slots. But if 500x [1
CPU &times; 4 GiB] jobs are submitted, all of the larger slots are broken up into
matching [1 CPU &times; 4 GiB] slots &mdash; resulting in a total of 231 jobs.</p>
<p>The reader may have noticed that there are 232 CPUs, and yet only 231 jobs would
be scheduled. This is because the [48 CPU &times; 190 GiB] slot (which has a RAM/CPU
ratio &lt; 4 GiB) cannot provide 4 GiB to each CPU; thus, one CPU is left idle.</p>
<p>The loss of 1 CPU for [1 CPU &times; 4 GiB] jobs is negligible. However, as an
exercise, the reader is encouraged to determine how much of the cluster would
be left idle when submitting [1 CPU &times; 5 GiB] jobs &mdash; and also [2 CPU &times; 20 GiB].</p>
</div>
<div class="section" id="matlab">
<h2 id="matlab">Matlab<a class="headerlink" href="#matlab" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<p>By default, Matlab will use all available CPUs. The preferred way to control
Matlab is to use the <tt class="docutils literal"><span class="pre">-singleCompthread</span></tt> option. There is also a
<a class="reference external" href="https://www.mathworks.com/help/matlab/ref/maxnumcompthreads.html">maxNumCompThreads()</a> function, but was deprecated but now seems to be back
from the dead. Any feedback on the efficacy of these function in recent Matlab
released (2019a and newer) is most appreciated.</p>
<p class="note"><strong>NOTE:</strong> With the increase in the number of available campus toolbox
licenses, it is no longer necessary to restrict Matlab jobs to specific
compute nodes.</p>
<p class="todo"><strong>TODO:</strong> Discuss Matlab Compiler</p>
</div>
<div class="section" id="intel-vs-amd">
<h2 id="intel vs amd">Intel vs AMD<a class="headerlink" href="#intel-vs-amd" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<p>Our cluster's Intel nodes have the fastest single thread performance. If you
have very few, single CPU jobs and need them to execute as fast as possible,
then restricting your jobs to the nodes with Intel CPUs can be beneficial.</p>
<p>The nodes are configured to advertise their CPU vendor, so it is easy to
constrain according to CPU type. Add the following to your <tt class="docutils literal">.submit</tt> file.</p>
<pre class="code literal-block">
Requirements = CPUVendor == "INTEL"
</pre>
<p>Or, to <em>prefer</em> Intel CPUs but not <em>require</em> them</p>
<pre class="code literal-block">
Rank = CPUVendor == "INTEL"
</pre>
</div>

  </div>
</article>
    </div>

    <footer>
      <p><small>
        content licensed <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">cc-by-sa</a>
        <span class='break'>—</span> ©2012–2020 Alex Waite <span class='break'>—</span>
        unless <a rel="license" href='/copyright.html'>indicated otherwise</a>
      </small></p>
    </footer>
  </main>
</body>
</html>