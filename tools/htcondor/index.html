<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="author" content="Alex Waite" />
  <title>IPSY Docs &ndash; HTCondor</title>
  <link rel="license" hreflang="en" href="../../copyright.html" />

  <link rel="stylesheet" type="text/css" href="/theme/css/style.css">
</head>

<body>
  <aside>
    <h1><a href="/">IPSY Docs</a></h1>
    <nav>
      <ul>

              <li><a href="/how_to_ask/">How to Ask for Help</a></li>
              <li><a href="/medusa/">Medusa</a></li>
              <li><a href="/labs/">Experimental Labs</a></li>
              <li>
                <a href="/tools/">Tools</a>

                <ul>
                  <li>
                    <a href="/tools/bids/">BIDS</a>
                  </li>
                  <li>
                    <a href="/tools/cli/">The Command Line</a>
                  </li>
                  <li>
                    <a href="/tools/datalad/">DataLad</a>
                  </li>
                  <li>
                    <a href="/tools/git/">Git</a>
                  </li>
                  <li>
                    <a class="active" href="/tools/htcondor/">HTCondor</a>
<div id="toc"><ul><li><a class="toc-href" href="#a simple sample" title="A Simple Sample">A Simple Sample</a></li><li><a class="toc-href" href="#anatomy of .submit" title="Anatomy of .submit">Anatomy of .submit</a></li><li><a class="toc-href" href="#generating a .submit" title="Generating a .submit">Generating a .submit</a></li><li><a class="toc-href" href="#useful commands" title="Useful Commands">Useful Commands</a></li><li><a class="toc-href" href="#documentation" title="Documentation">Documentation</a></li></ul></div>                  </li>
                  <li>
                    <a href="/tools/python/">Python</a>
                  </li>
                  <li>
                    <a href="/tools/r/">R</a>
                  </li>
                  <li>
                    <a href="/tools/sixel/">sixel</a>
                  </li>
                  <li>
                    <a href="/tools/ssh/">SSH</a>
                  </li>
                  <li>
                    <a href="/tools/tmux/">tmux</a>
                  </li>
                </ul>
              </li>
              <li><a href="/services/">Services</a></li>
              <li><a href="/faq/">Frequently Asked Questions</a></li>
              <li><a href="/contributing/">Contributing to the Docs</a></li>
              <li><a href="/news/">News</a></li>
      </ul>
    </nav>
    <form class="searchbox" action="/search.html">
      <input type="text" name="q" id="tipue_search_input" placeholder="Search">
    </form>
  </aside>

  <main>
    <div id='content'>
<article>
  <header>
    <nav>
      <ul class="breadcrumbs">
        <li><a href="/">Home</a></li>
        <li> > <a href="/tools/">Tools</a></li>
        <li> > HTCondor</li>
      </ul>
    </nav>
    <h1>HTCondor</h1>
  </header>

  <div>
    <p>HTCondor (also known as condor) is a job scheduler. It is powerful, but
conceptually quite simple. Condor:</p>
<ul class="simple">
<li>runs the jobs you tell it to</li>
<li>finds places to run those jobs</li>
<li>makes sure everyone has fair access to resources</li>
</ul>
<p>There are two aspects when teaching people how to use Condor:</p>
<ol class="arabic simple">
<li>Using Condor itself (useful commands, the <tt class="docutils literal">.submit</tt> file). This is
<strong>relatively easy</strong>, and is what this document focuses on.</li>
<li>Understanding the problems your scripts are trying to solve, and how to
break those up into conceptually discrete steps and units. Put another way:
how to not use the cluster like one big laptop and instead like thousands
of tiny desktops. For many people, this is the <strong>not so easy</strong> part.</li>
</ol>
<div class="section" id="a-simple-sample">
<h2 id="a simple sample">A Simple Sample<a class="headerlink" href="#a-simple-sample" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<p>Let's keep things simple. You want to run the command <tt class="docutils literal">fortune</tt> using condor.
Just one job. Here's how we do so:</p>
<ol class="arabic">
<li><p class="first">create a file called <tt class="docutils literal">fortune.submit</tt> defining your job:</p>
<pre class="code literal-block">
# The environment
universe       = vanilla
getenv         = True
request_cpus   = 1
request_memory = 1G

# Execution
initial_dir    = $ENV(HOME)
executable     = /usr/games/fortune

# Job
log            = $ENV(HOME)/logs/fortune_$(Cluster).$(Process).log
output         = $ENV(HOME)/logs/fortune_$(Cluster).$(Process).out
error          = $ENV(HOME)/logs/fortune_$(Cluster).$(Process).err
Queue
</pre>
</li>
<li><p class="first">create a folder for the logs:</p>
<pre class="code literal-block">
mkdir ~/logs
</pre>
</li>
<li><p class="first">submit the job to condor</p>
<pre class="code literal-block">
condor_submit fortune.submit
</pre>
</li>
<li><p class="first">watch the queue (the job will move from IDLE, to RUN, and then then will
disappear, meaning it has finished).</p>
<pre class="code literal-block">
condor_q
</pre>
</li>
<li><p class="first">read the output file containing your fortune</p>
<pre class="code literal-block">
cat ~/logs/fortune_*.out
</pre>
</li>
</ol>
</div>
<div class="section" id="anatomy-of-submit">
<h2 id="anatomy of .submit">Anatomy of .submit<a class="headerlink" href="#anatomy-of-submit" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<p>To accomplish more than the simple example above, you'll need to understand the
anatomy of a submit file.</p>
<p>A <tt class="docutils literal">.submit</tt> file describes the jobs (commands and their arguments) that condor
will run, the environment they will run in, and the needed hardware resources
(RAM, CPU).</p>
<p>This example defines two jobs, and this time with an argument. One job outputs
the calendar for 1985 and the second job for 1986.</p>
<pre class="code literal-block">
# The environment
universe       = vanilla
getenv         = True
request_cpus   = 1
request_memory = 1G

# Execution
initial_dir    = $ENV(HOME)
executable     = /usr/bin/ncal

# Logs
log            = $ENV(HOME)/logs/$(Cluster).$(Process).log
output         = $ENV(HOME)/logs/$(Cluster).$(Process).out
error          = $ENV(HOME)/logs/$(Cluster).$(Process).err

# Job 1
arguments = "1985"
Queue

# Job 2
arguments = "1986"
Queue
</pre>
<p>Breaking this into sections:</p>
<ul>
<li><pre class="code first literal-block">
universe = vanilla
getenv   = True
</pre>
<p>The first two lines you likely will never need to change. <tt class="docutils literal">universe</tt>
declares the <em>type</em> of Condor environment used, and <tt class="docutils literal">getenv</tt> tells Condor
to copy environmental variables from your execution environment to the
compute nodes.  Unless you know what you're doing, keep these lines
unchanged.</p>
</li>
<li><pre class="code first literal-block">
request_cpus   = 1
request_memory = 1G
</pre>
<p>Often people don't know how much RAM their job will consume. In that case,
make an educated guess, and then submit a single job. When it completes,
check its <tt class="docutils literal">.log</tt> file.  It contains information about the memory usage of
the job.</p>
</li>
<li><pre class="code first literal-block">
initial_dir = $ENV(HOME)
</pre>
<p>This is the directory that Condor will <tt class="docutils literal">cd</tt> to when starting your job. All
paths are relative to this starting directory (unless they are absolute
paths, i.e. starting with a <tt class="docutils literal">/</tt>). In this case, it is your user's home
folder.</p>
</li>
<li><pre class="code first literal-block">
executable = /usr/bin/ncal
</pre>
<p>Next comes the <tt class="docutils literal">executable</tt>. It is common for users to simply enter the
command name. This is often wrong. Re-read the description above for
<tt class="docutils literal">initial_dir</tt>, and you will see that if <tt class="docutils literal">executable</tt> is set to <tt class="docutils literal">ncal</tt>,
it would try to run <tt class="docutils literal">/$HOME/ncal</tt>. This <em>is</em> usually what you want when
you're executing a script you've written, but it's not what you want when
executing a system utility. In that case, use an absolute path.</p>
</li>
<li><pre class="code first literal-block">
# Logs
log       = $ENV(HOME)/logs/$(Cluster).$(Process).log
output    = $ENV(HOME)/logs/$(Cluster).$(Process).out
error     = $ENV(HOME)/logs/$(Cluster).$(Process).err
</pre>
<p>The log files store information about the job. The <tt class="docutils literal">$(Cluster)</tt> and
<tt class="docutils literal">$(Process)</tt> macros supply the job ID, and are used here to create unique
log files for each job.</p>
<ul class="simple">
<li><tt class="docutils literal">log</tt>: for information about the condor job (duration, memory usage, the
machine it ran on, etc)</li>
<li><tt class="docutils literal">output</tt>: anything the job writes to stdout</li>
<li><tt class="docutils literal">error</tt>: anything the job writes to stderr</li>
</ul>
</li>
<li><pre class="code first literal-block">
# Job 1
arguments = "1985"
Queue
</pre>
<p>The <tt class="docutils literal">arguments</tt> are what is passed to the <tt class="docutils literal">executable</tt>.</p>
<p>Then comes <tt class="docutils literal">Queue</tt>. This means "submit a job". The state of all variables
up to this point will be submitted as a job. We will soon see, with the
second job, how this is powerful.</p>
</li>
<li><pre class="code first literal-block">
# Job 2
arguments = "1986"
Queue
</pre>
<p>The <tt class="docutils literal">arguments</tt> variable is overwritten, and then we <tt class="docutils literal">Queue</tt> another job.
It's as simple as that. In this case, jobs 1 and 2 are identical except for
their arguments.</p>
<p>You may wonder how the log files are unique for each job if we havn't
redefined them. This is because we're using condor macros to refer to the job
ID. That being said, it is quite common to redefine the log files for each
job, containing more human-useful information.</p>
</li>
</ul>
</div>
<div class="section" id="generating-a-submit">
<h2 id="generating a .submit">Generating a .submit<a class="headerlink" href="#generating-a-submit" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<p>Condor's strength is not running one job at a time. It's strength is running
thousands of jobs at a time, and no one in their right mind writes such submit
files by hand. A simple script is used to generate them.</p>
<p>We'll do a repeat of the above jobs, but this time outputing calendars for the
last ~1,000 years.</p>
<pre class="code literal-block">
#!/bin/sh
# v3.0

logs_dir=~/logs
# create the logs dir if it doesn't exist
[ ! -d "$logs_dir" ] &amp;&amp; mkdir -p "$logs_dir"

# print the .submit header
printf "# The environment
universe       = vanilla
getenv         = True
request_cpus   = 1
request_memory = 1G

# Execution
initial_dir    = \$ENV(HOME)
executable     = /usr/bin/ncal
\n"

# create a job for each subject file
for year in $(seq 1000 1999); do
    printf "arguments = ${year}\n"
    printf "log       = ${logs_dir}/y${year}_\$(Cluster).\$(Process).log\n"
    printf "output    = ${logs_dir}/y${year}_\$(Cluster).\$(Process).out\n"
    printf "error     = ${logs_dir}/y${year}_\$(Cluster).\$(Process).err\n"
    printf "Queue\n\n"
done
</pre>
<p>Let's run the script and make sure that the output looks sane (if it fails with
"permission denied", you probably forgot to mark it as executable by using
<tt class="docutils literal">chmod +x</tt>).</p>
<pre class="code literal-block">
./ncal_submit_gen.sh
</pre>
<p>If everything looks good, then it's time to submit the jobs directly to condor.</p>
<pre class="code literal-block">
./ncal_submit_gen.sh | condor_submit
</pre>
<p>And you just submitted 1,000 jobs to condor.</p>
</div>
<div class="section" id="useful-commands">
<h2 id="useful commands">Useful Commands<a class="headerlink" href="#useful-commands" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<dl class="docutils">
<dt>List all slots (available and used) and their size</dt>
<dd><pre class="code first last literal-block">
condor_status
</pre>
</dd>
<dt>Submit a job/job cluster</dt>
<dd><pre class="code first last literal-block">
condor_submit &lt;file.submit&gt;
</pre>
</dd>
<dt>To gain access to an interactive shell on a node &mdash; even with a GUI.</dt>
<dd><pre class="code first last literal-block">
condor_submit -interactive &lt;file.submit&gt;
</pre>
</dd>
<dt>Summary of your jobs in the queue</dt>
<dd><pre class="code first last literal-block">
condor_q
</pre>
</dd>
<dt>All of your running jobs and which machine they are on</dt>
<dd><pre class="code first last literal-block">
condor_q -nobatch -run
</pre>
</dd>
<dt>All jobs from all users in the queue</dt>
<dd><pre class="code first last literal-block">
condor_q -nobatch -allusers
</pre>
</dd>
<dt>Explain why a job is in a particular state</dt>
<dd><pre class="code first last literal-block">
condor_q -better-analyze &lt;jobid&gt;
</pre>
</dd>
<dt>Remove jobs from the queue</dt>
<dd><pre class="code first last literal-block">
condor_rm &lt;username&gt;            # remove all jobs for this (your) user
condor_rm &lt;clusterid&gt;           # remove all jobs belonging to this cluster
condor_rm &lt;clusterid&gt;.&lt;jobid&gt;   # remove this specific job
</pre>
</dd>
<dt>User statistics, priority, and priority factor</dt>
<dd><pre class="code first last literal-block">
condor_userprio --allusers
</pre>
</dd>
<dt>For those who are more familiar with Sun's GridEngine, Condor provides <tt class="docutils literal">condor_qsub</tt>.</dt>
<dd><pre class="code first last literal-block">
condor_qsub
</pre>
</dd>
</dl>
</div>
<div class="section" id="documentation">
<h2 id="documentation">Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<p>The <a class="reference external" href="https://htcondor.readthedocs.io/en/v8_8_5/">official Condor documentation</a> is long, but comprehensive. If you have
questions, their docs are a great resource. Pay special attention to the
sections on <a class="reference external" href="https://htcondor.readthedocs.io/en/v8_8_5/users-manual/submitting-a-job.html">Submitting a Job</a> and <a class="reference external" href="https://htcondor.readthedocs.io/en/v8_8_5/users-manual/managing-a-job.html">Managing a Job</a>.</p>
</div>

  </div>
</article>
    </div>

    <footer>
      <p><small>
        content licensed <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">cc-by-sa</a>
        <span class='break'>—</span> ©2012–2020 Alex Waite <span class='break'>—</span>
        unless <a rel="license" href='/copyright.html'>indicated otherwise</a>
      </small></p>
    </footer>
  </main>
</body>
</html>